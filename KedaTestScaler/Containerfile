FROM python:3.12-slim

ENV PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1

WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
        ca-certificates \
        curl \
    && rm -rf /var/lib/apt/lists/* \
    && curl -L -o /tmp/podman-remote.tar.gz https://github.com/containers/podman/releases/download/v4.8.0/podman-remote-static-linux_amd64.tar.gz \
    && tar xzf /tmp/podman-remote.tar.gz -C /tmp \
    && mv /tmp/bin/podman-remote-static-linux_amd64 /usr/local/bin/podman \
    && chmod +x /usr/local/bin/podman \
    && rm -rf /tmp/podman-remote.tar.gz /tmp/bin

COPY requirements.txt ./
RUN pip install -r requirements.txt

COPY . .

RUN adduser --disabled-password --gecos "" appuser && chown -R appuser /app
USER appuser

ENTRYPOINT ["python", "-m", "keda_test_scaler"] 